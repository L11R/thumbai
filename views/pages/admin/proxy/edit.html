<!-- Copyright Jeevanandam M. (https://github.com/jeevatkm, jeeva@myjeeva.com)

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

   http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License. -->

{{ define "title" }}
<title>Edit Proxy Rules: {{ pparam . "hostName" }} - THUMBAI</title>
{{ end }} 

{{ define "meta_extra" }}
<meta name="anti_csrf_token" content="{{ anticsrftoken . }}">
{{ end }}

{{ define "body-content" -}}
<div class="admin-proxy-edit">
    <div class="container-fluid no-gutters mb-4">
        <div class="row align-items-center no-gutters">
            <div class="col">
                <span class="h1">Proxy Host:</span><span class="h1 font-weight-bold ml-2">{{ .ProxyHostName }}</span>
            </div>
            <div class="col text-right">
                <a href="{{ rurl . "proxy_show" .ProxyHostName }}" data-toggle="tooltip" title="Back to Proxy Host" class="btn btn-sm btn-outline-success pl-4 pr-4">Back</a>
            </div>
        </div>
        <div class="row no-gutters">
            <div class="admin-proxy-rule-sec w-100 mt-4">
                <form id="formTargetURL" action="">
                    <div class="form-group">
                        <label for="proxyTargetURL" class="d-flex font-weight-bold align-items-center">Target URL
                            <div class="form-check form-check-inline ml-3 font-weight-normal">
                                <input class="form-check-input" type="checkbox" id="proxyLastRule" name="proxyLastRule" value="lastrule">
                                <label class="form-check-label" for="proxyLastRule">Last Rule</label>
                            </div>
                        </label>
                        <input type="text" class="form-control" id="proxyTargetURL" name="proxyTargetURL" placeholder="Enter Proxy Target URL" aria-describedby="proxyTargetURLHelp" value="{{ if .ProxyRule }}{{ .ProxyRule.TargetURL }}{{ end }}" required>
                        <div id="proxyTargetURLError" class="invalid-feedback">Required</div>
                    </div>
                    <div class="float-right mt-3 pb-2">
                        <button type="submit" class="btn btn-sm btn-success pl-4 pr-4">Save</button>
                    </div>
                </form>                
            </div>
        </div>
        <div class="row no-gutters mt-4">
            <div class="admin-proxy-rule-sec w-100">
                <div class="admin-proxy-rule-sec-hdr" data-toggle="collapse" href="#conditionSection" role="button" aria-expanded="false" aria-controls="conditionSection">
                    Conditions <span class="text-muted">(Optional)</span>
                </div>
                <div class="collapse" id="conditionSection">
                    <div class="card card-body mt-2">
                        <form id="formRules" action="">
                            <div class="form-group row">
                                <label for="proxyPath" class="col-sm-2 col-form-label text-right">Path</label>
                                <div class="col-sm-10">
                                    <input type="text" class="form-control" id="proxyPath" name="proxyPath" placeholder="Enter relative request path">
                                    <small id="proxyPathHelp" class="form-text text-muted">
                                    Relative path to match, regex supported too, syntax: <code>{regex-here}</code>.<br>
                                    E.g.: <code>{^/(.*)\\.v0(.*)$}</code>
                                    </small>
                                    <div id="proxyPathError" class="invalid-feedback"></div>
                                </div>
                            </div>
                            <div class="form-group row">
                                <label for="proxyQueryParams" class="col-sm-2 col-form-label text-right">Query Params</label>
                                <div class="col-sm-10">
                                    <textarea class="form-control" id="proxyQueryParams" name="proxyQueryParams" rows="3" placeholder="Enter query params to match"></textarea>
                                    <small id="proxyQueryParamsHelp" class="form-text text-muted">
                                    Each query param and value pair per line, e.g: <code>Query_Params = Query_Params value</code>.
                                    </small>
                                    <div id="proxyQueryParamsError" class="invalid-feedback"></div>
                                </div>
                            </div>
                            <div class="form-group row">
                                <label for="proxyHeaders" class="col-sm-2 col-form-label text-right">Headers</label>
                                <div class="col-sm-10">
                                    <textarea class="form-control" id="proxyHeaders" name="proxyHeaders" rows="3" placeholder="Enter headers to match"></textarea>
                                    <small id="proxyHeadersHelp" class="form-text text-muted">
                                    Each header key and value pair per line, e.g: <code>Header-Key = Header value</code>.
                                    </small>
                                    <div id="proxyHeadersError" class="invalid-feedback"></div>
                                </div>
                            </div>
                            <div class="float-right mt-2 pb-2">
                                <button type="submit" class="btn btn-sm btn-success pl-4 pr-4">Save</button>
                            </div>
                        </form>
                    </div>
                </div>                
            </div>
        </div>
        <div class="row no-gutters mt-4">
            <div class="admin-proxy-rule-sec w-100">
                <div class="admin-proxy-rule-sec-hdr" data-toggle="collapse" href="#redirectsSection" role="button" aria-expanded="false" aria-controls="redirectsSection">
                    Redirects <span class="text-muted">(Optional)</span>
                </div>
                <div class="collapse" id="redirectsSection">
                    <div class="card card-body mt-2">
                        <form id="formRedirects" action="">
                            <div class="form-group row">
                                <label for="proxyRedirects" class="col-sm-2 col-form-label text-right">Redirect Mapping</label>
                                <div class="col-sm-10">
                                    <textarea class="form-control rule-value" id="proxyRedirects" name="proxyRedirects" rows="7" placeholder="Enter redirect  URLs">{{ if .ProxyRule }}{{ redirect2line .ProxyRule.Redirects }}{{ end}}</textarea>
                                    <small id="proxyRedirectsHelp" class="form-text text-muted">
                                    Each redirect mapping per line, syntax: <code>from-path, to-path-or-url, code (optional)</code>.<br>
                                    E.g.: <code>{^/v0.5/(.*)$}, https://docs.aahframework.org/{1}, 301</code>
                                    </small>
                                    <div id="proxyRedirectsError" class="invalid-feedback"></div>
                                </div>
                            </div>
                            <div class="float-right mt-2 pb-2">
                                <button type="submit" class="btn btn-sm btn-success pl-4 pr-4">Save</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
        <div class="row no-gutters mt-4">
            <div class="admin-proxy-rule-sec w-50 pr-2">
                <div class="admin-proxy-rule-sec-hdr" data-toggle="collapse" href="#restrictStaticFilesSection" role="button" aria-expanded="false" aria-controls="restrictStaticFilesSection">
                    Restrict Files <span class="text-muted">(Optional)</span>
                </div>
                <div class="collapse" id="restrictStaticFilesSection">
                    <div class="card card-body mt-2">
                        <form action="">
                            <div class="form-group row">
                                <label for="proxyRestrictByExt" class="col-sm-2 col-form-label text-right">By Extension</label>
                                <div class="col-sm-10">
                                    <textarea class="form-control" id="proxyRestrictByExt" name="proxyRestrictByExt" rows="3" placeholder="Enter file extension to restrict"></textarea>
                                    <small id="proxyRestrictByExtHelp" class="form-text text-muted">
                                    Each file extension per line.
                                    </small>
                                    <div id="proxyRestrictByExtError" class="invalid-feedback"></div>
                                </div>
                            </div>
                            <div class="form-group row">
                                <label for="proxyRestrictByRegex" class="col-sm-2 col-form-label text-right">By Regex</label>
                                <div class="col-sm-10">
                                    <textarea class="form-control" id="proxyRestrictByRegex" name="proxyRestrictByRegex" rows="3" placeholder="Enter headers to match"></textarea>
                                    <small id="proxyRestrictByRegexHelp" class="form-text text-muted">
                                    Each regex per line e.g. <code>{regex-here}</code>.
                                    </small>
                                    <div id="pproxyRestrictByRegexError" class="invalid-feedback"></div>
                                </div>
                            </div>
                            <div class="float-right mt-2 pb-2">
                                <button type="submit" class="btn btn-sm btn-success pl-4 pr-4">Save</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
            <div class="admin-proxy-rule-sec w-50 pl-2">
                <div class="admin-proxy-rule-sec-hdr" data-toggle="collapse" href="#restrictStaticFilesSection" role="button" aria-expanded="false" aria-controls="restrictStaticFilesSection">
                    Static Files <span class="text-muted">(Optional)</span>
                </div>
                <div class="collapse" id="restrictStaticFilesSection">
                    <div class="card card-body mt-2">
                        <form action="">
                            <div class="form-group row">
                                <label for="proxyStaticFiles" class="col-sm-2 col-form-label text-right">Mapping</label>
                                <div class="col-sm-10">
                                    <textarea class="form-control" id="proxyStaticFiles" name="proxyStaticFiles" rows="3" placeholder="Enter directory mapping to deliver statis files"></textarea>
                                    <small id="proxyStaticFilesHelp" class="form-text text-muted">
                                    Each directory mapping per line e.g.: <code>root-directory, strip-prefix (optional)</code>.
                                    </small>
                                    <div id="proxyStaticFilesError" class="invalid-feedback"></div>
                                </div>
                            </div>
                            <div class="float-right mt-2 pb-2">
                                <button type="submit" class="btn btn-sm btn-success pl-4 pr-4">Save</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
        <div class="row no-gutters mt-4">
            <div class="admin-proxy-rule-sec w-50 pr-2">
                <div class="admin-proxy-rule-sec-hdr" data-toggle="collapse" href="#requestResponseHdrSection" role="button" aria-expanded="false" aria-controls="requestResponseHdrSection">
                    Request Headers <span class="text-muted">(Optional)</span>
                </div>
                <div class="collapse" id="requestResponseHdrSection">
                    <div class="card card-body mt-2">
                        <form action="">
                            <div class="form-group row">
                                <label for="proxyRequestHeaders" class="col-sm-2 col-form-label text-right">Headers</label>
                                <div class="col-sm-10">
                                    <textarea class="form-control" id="proxyRequestHeaders" name="proxyRequestHeaders" rows="3" placeholder="Enter request headers to be added before proxying a request"></textarea>
                                    <small id="proxyRequestHeadersHelp" class="form-text text-muted">
                                    Each header key and value pair per line, e.g: <code>Header-Key = Header value</code>.
                                    </small>
                                    <div id="proxyRequestHeadersError" class="invalid-feedback"></div>
                                </div>
                            </div>
                            <div class="float-right mt-2 pb-2">
                                <button type="submit" class="btn btn-sm btn-success pl-4 pr-4">Save</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
            <div class="admin-proxy-rule-sec w-50 pl-2">
                <div class="admin-proxy-rule-sec-hdr" data-toggle="collapse" href="#requestResponseHdrSection" role="button" aria-expanded="false" aria-controls="requestResponseHdrSection">
                    Response Headers <span class="text-muted">(Optional)</span>
                </div>
                <div class="collapse" id="requestResponseHdrSection">
                    <div class="card card-body mt-2">
                        <form action="">
                            <div class="form-group row">
                                <label for="proxyResponseHeaders" class="col-sm-2 col-form-label text-right">Headers</label>
                                <div class="col-sm-10">
                                    <textarea class="form-control" id="proxyResponseHeaders" name="proxyResponseHeaders" rows="3" placeholder="Enter response headers to be added for the proxy response"></textarea>
                                    <small id="proxyResponseHeadersHelp" class="form-text text-muted">
                                    Each header key and value pair per line, e.g: <code>Header-Key = Header value</code>.
                                    </small>
                                    <div id="proxyResponseHeadersError" class="invalid-feedback"></div>
                                </div>
                            </div>
                            <div class="float-right mt-2 pb-2">
                                <button type="submit" class="btn btn-sm btn-success pl-4 pr-4">Save</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{{ end }}