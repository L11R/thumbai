{{ define "title" }}
<title>Go Modules - THUMBAI</title>
{{ end }}

{{ define "body-content" -}}
<div class="admin-gomodules">
    <div>
        <span class="h1">Go Modules</span><span class="total-mod-count pl-3">({{ .Stats.TotalCount }} available & counting ...)</span>
    </div>
    {{ if not .Settings.Enabled }}
    <div>
        <p class="alert alert-danger w-50">Go Proxy Server unavailable due to prerequisites does not met on the server.</p>
    </div>{{ end }}
    <div class="w-50 mt-4 pl-1">
        <form id="goModulesForm" method="post" action="{{ rurl . "gomod_admin_save" }}">
            <div class="form-group">
                <label for="goBinary">Go Binary</label><span class="ml-2 badge badge-success">go{{ .Settings.GoVersion }}</span>
                <input type="text" class="form-control" id="goBinary" name="goBinary" value="{{ .Settings.GoBinary }}" placeholder="Enter the path to Go binary on the server" aria-describedby="goBinaryHelp" required>
                <small id="goBinaryHelp" class="form-text text-muted">
                Ensure given binary is go1.11 or above.
                </small>
                <div id="goBinaryError" class="invalid-feedback">Required</div>
            </div>
            <div class="form-group">
                <label for="goPath">GOPATH</label>
                <input type="text" class="form-control" id="goPath" name="goPath" value="{{ .Settings.GoPath }}" placeholder="Enter the GOPATH on the server" required>
                <small id="goBinaryHelp" class="form-text text-muted">
                Ensure given GOPATH have read/write permission thumbai app.
                </small>
                <div id="goPathError" class="invalid-feedback">Required</div>
            </div>
            <span id="formResponse"></span>
            <button id="goModulesSubmit" type="submit" class="btn btn-success float-right pl-4 pr-4">Save</button>
        </form>
    </div>
</div>
<script>
    window.jqReady = function () {
        var goModForm = $('#goModulesForm');
        goModForm.submit(function (e) {
            e.preventDefault();
            disableWithSpinner('goModulesSubmit');
            $.ajax({
                url: e.currentTarget.action,
                method: 'post',
                data: goModForm.serialize()
            }).done(function (res) {
                $('#formResponse').html('<strong>Settings saved!</strong>').addClass('text-success').fadeIn();
                enableWithoutSpinner('goModulesSubmit');
            }).fail(function (res) {
                var data = res.responseJSON;
                if (data.errors) {
                    markFieldErrors(data.errors);
                }
                $('#formResponse').html('<strong>Unable to save settings!</strong>').addClass('text-danger').fadeIn();
                enableWithoutSpinner('goModulesSubmit');
            });
            setTimeout(function () { 
                $('#formResponse').fadeOut('slow', function(){
                    $(this).removeClass('text-danger text-success');
                }); 
            }, 3000);
        });
        applyOnKeydownRemoveError('goModulesForm');
    }
</script>
{{ end }}