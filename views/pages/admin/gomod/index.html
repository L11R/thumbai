{{ define "title" }}
<title>Go Modules - THUMBAI</title>
{{ end }}

{{ define "body-content" -}}
<div class="admin-gomodules">
    <div>
        <span class="h1">Go Modules</span><span class="total-mod-count pl-3">({{ .Stats.TotalCount }} available & counting ...)</span>
    </div>
    {{ if not .Settings.Enabled }}
    <div>
        <p class="alert alert-danger w-50">Go Proxy Server unavailable due to prerequisites does not met on the server.</p>
    </div>{{ end }}
    <div class="w-50 mt-4 pl-1">
        <form id="goModulesForm" method="post" action="{{ rurl . "gomod_save_settings" }}">
            <div class="form-group">
                <label for="goBinary">Go Binary</label><span class="ml-2 badge badge-success">go{{ .Settings.GoVersion }}</span>
                <input type="text" class="form-control" id="goBinary" name="goBinary" value="{{ .Settings.GoBinary }}" placeholder="Enter the path to Go binary on the server" aria-describedby="goBinaryHelp" required>
                <small id="goBinaryHelp" class="form-text text-muted">
                Ensure given binary is go1.11 or above.
                </small>
                <div id="goBinaryError" class="invalid-feedback">Required</div>
            </div>
            <div class="form-group">
                <label for="goPath">GOPATH</label>
                <input type="text" class="form-control" id="goPath" name="goPath" value="{{ .Settings.GoPath }}" placeholder="Enter the GOPATH on the server" required>
                <small id="goBinaryHelp" class="form-text text-muted">
                Ensure given GOPATH have read/write permission thumbai app.
                </small>
                <div id="goPathError" class="invalid-feedback">Required</div>
            </div>
            <button id="goModulesSubmit" type="submit" class="btn btn-success float-right pl-4 pr-4">Save</button>
        </form>
    </div>
</div>
<script>
window.jqReady(function () {
    var goModForm = $('#goModulesForm');
    goModForm.submit(function (e) {
        e.preventDefault();
        disableWithSpinner('goModulesSubmit');
        $.ajax({
            url: e.currentTarget.action,
            method: 'post',
            data: goModForm.serialize(),
        }).done(function (res) {
            showFeedback('success', 'Go modules settings saved!');
            enableWithoutSpinner('goModulesSubmit');
        }).fail(function (res) {
            var data = res.responseJSON;
            if (data.errors) {
                markFieldErrors(data.errors);
            }
            showFeedback('failure', 'Unable to save Go modules settings!');
            enableWithoutSpinner('goModulesSubmit');
        });
        fadeOutFeedback(3000);
        return false;
    });
    applyOnKeydownRemoveError('goModulesForm');
});
</script>
{{ end }}